<!-- PARTIE 1/2 - coller ceci en premier dans le Bloc-notes -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Apilesbordes - Miel artisanal</title>

  <style>
    :root{--bg:#fffbee;--accent:#f6c90e;--dark:#3e2f00;}
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:var(--bg); color:#333; }
    header { background:var(--accent); padding:18px; text-align:center; font-size:28px; font-weight:700; color:var(--dark); }
    section { padding:18px; text-align:center; }
    .products { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; }
    .product { background:#fff8d9; border-radius:12px; padding:18px; width:340px; box-shadow:0 4px 8px rgba(0,0,0,0.08); text-align:center; }
    .product img { max-width:100%; border-radius:10px; display:block; margin:0 auto 10px; }
    .price { font-size:16px; font-weight:700; color:var(--dark); margin:10px 0; }
    label { font-weight:700; display:block; margin-top:8px; text-align:left; }
    select, input[type=text], input[type=email], input[type=tel], textarea { width:100%; padding:8px; margin-top:6px; border:1px solid #ccc; border-radius:6px; box-sizing:border-box; }
    button, .form-button { background:var(--accent); border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:700; }
    button:hover, .form-button:hover { background:#e0b80d; }
    .form { background:#fff8d9; padding:18px; border-radius:12px; max-width:900px; margin:20px auto; text-align:left; box-shadow:0 4px 8px rgba(0,0,0,0.08); }
    .small { font-size:0.9rem; color:#666; }
    .relay-list, .relay-list div { max-width:900px; margin:10px auto; text-align:left; }
    .relay-item { border:1px solid #ddd; padding:10px; margin:6px 0; border-radius:6px; cursor:pointer; }
    .relay-item:hover { background:#f0f0f0; }
    footer { text-align:center; padding:20px; background:var(--accent); margin-top:20px; color:var(--dark); }
    .note { font-style:italic; color:#a00; margin-top:10px; }
    @media (max-width:820px) {
      .products { flex-direction:column; align-items:center; }
      .product { width:92%; }
    }
  </style>

  <!-- PayPal SDK (global) -->
  <script src="https://www.paypal.com/sdk/js?client-id=BAAKdibcjfq3zIS83uVKN9R6ZokO_hZe3nKWAzIiX1Kqor-AlXWg0u_PADbEJP1nE1Oy6oRlj9wq8xaEjU&components=hosted-buttons&disable-funding=venmo&currency=EUR"></script>
</head>
<body>

<header>🍯 Apilesbordes - Miel artisanal</header>

<section>
  <h2>Nos miels</h2>
  <p class="small">Miels 100% naturels, récoltés avec passion en Sologne et en Forêt.</p>
</section>

<!-- ================= MIEL DE SOLOGNE ================= -->
<section>
  <h2>🍯 Miel de Sologne</h2>
  <div class="products">

    <!-- Sologne 250g -->
    <div class="product" id="block-SOLOGNE250">
      <h3>Miel de Sologne — Pot 250g</h3>
      <img src="images/miel_sologne_250.jpg" alt="Miel de Sologne 250g">
      <p class="price">5 € (250g)</p>

      <label for="SOLOGNE250">Choisir (Retrait / Colissimo / Mondial Relay)</label>
      <select id="SOLOGNE250" onchange="updateButton('SOLOGNE250')">
        <option value="">-- Sélectionnez --</option>
        <option value="ID01">Retrait – 1 pot – 5 €</option>
        <option value="ID02">Retrait – 2 pots – 10 €</option>
        <option value="ID03">Retrait – 3 pots – 15 €</option>
        <option value="ID04">Colissimo – 1 pot – 12,35 €</option>
        <option value="ID05">Colissimo – 2 pots – 19,40 €</option>
        <option value="ID06">Colissimo – 3 pots – 28,10 €</option>
        <option value="ID07">Mondial Relay – 1 pot – 9,40 €</option>
        <option value="ID08">Mondial Relay – 2 pots – 15,40 €</option>
        <option value="ID09">Mondial Relay – 3 pots – 21,40 €</option>
      </select>

      <div id="paypal-SOLOGNE250" style="margin-top:12px;"></div>
    </div>

    <!-- Sologne 500g -->
    <div class="product" id="block-SOLOGNE500">
      <h3>Miel de Sologne — Pot 500g</h3>
      <img src="images/miel_sologne_500.jpg" alt="Miel de Sologne 500g">
      <p class="price">7 € (500g)</p>

      <label for="SOLOGNE500">Choisir (Retrait / Colissimo / Mondial Relay)</label>
      <select id="SOLOGNE500" onchange="updateButton('SOLOGNE500')">
        <option value="">-- Sélectionnez --</option>
        <option value="ID10">Retrait – 1 pot – 7 €</option>
        <option value="ID11">Retrait – 2 pots – 14 €</option>
        <option value="ID12">Retrait – 3 pots – 21 €</option>
        <option value="ID13">Colissimo – 1 pot – 16,40 €</option>
        <option value="ID14">Colissimo – 2 pots – 27,10 €</option>
        <option value="ID15">Colissimo – 3 pots – 35,65 €</option>
        <option value="ID16">Mondial Relay – 1 pot – 12,40 €</option>
        <option value="ID17">Mondial Relay – 2 pots – 20,40 €</option>
        <option value="ID18">Mondial Relay – 3 pots – 28,40 €</option>
      </select>

      <div id="paypal-SOLOGNE500" style="margin-top:12px;"></div>
    </div>

    <!-- Sologne 1kg -->
    <div class="product" id="block-SOLOGNE1KG">
      <h3>Miel de Sologne — Pot 1kg</h3>
      <img src="images/miel_sologne_1kg.jpg" alt="Miel de Sologne 1kg">
      <p class="price">13 € (1kg)</p>

      <label for="SOLOGNE1KG">Choisir (Retrait / Colissimo / Mondial Relay)</label>
      <select id="SOLOGNE1KG" onchange="updateButton('SOLOGNE1KG')">
        <option value="">-- Sélectionnez --</option>
        <option value="ID19">Retrait – 1 pot – 13 €</option>
        <option value="ID20">Retrait – 2 pots – 26 €</option>
        <option value="ID21">Retrait – 3 pots – 39 €</option>
        <option value="ID22">Colissimo – 1 pot – 26,10 €</option>
        <option value="ID23">Colissimo – 2 pots – 40,65 €</option>
        <option value="ID24">Colissimo – 3 pots – 53,65 €</option>
        <option value="ID25">Mondial Relay – 1 pot – 19,40 €</option>
        <option value="ID26">Mondial Relay – 2 pots – 33,40 €</option>
      </select>

      <div id="paypal-SOLOGNE1KG" style="margin-top:12px;"></div>
    </div>

  </div>
</section>

<!-- ================= FIN PARTIE 1/2 - (Sologne complet) ================= -->
<!-- PARTIE 2/2 - coller juste après la PARTIE 1/2 -->

<!-- ================= MIEL DE FORÊT ================= -->
<section>
  <h2>🌲 Miel de Forêt</h2>
  <div class="products">

    <!-- Forêt 250g -->
    <div class="product" id="block-FORET250">
      <h3>Miel de Forêt — Pot 250g</h3>
      <img src="images/miel_foret_250.jpg" alt="Miel de Forêt 250g">
      <p class="price">5 € (250g)</p>

      <label for="FORET250">Choisir (Retrait / Colissimo / Mondial Relay)</label>
      <select id="FORET250" onchange="updateButton('FORET250')">
        <option value="">-- Sélectionnez --</option>
        <option value="ID27">Retrait – 1 pot – 5 €</option>
        <option value="ID28">Retrait – 2 pots – 10 €</option>
        <option value="ID29">Retrait – 3 pots – 15 €</option>
        <option value="ID30">Colissimo – 1 pot – 12,35 €</option>
        <option value="ID31">Colissimo – 2 pots – 19,40 €</option>
        <option value="ID32">Colissimo – 3 pots – 28,10 €</option>
        <option value="ID33">Mondial Relay – 1 pot – 9,40 €</option>
        <option value="ID34">Mondial Relay – 2 pots – 15,40 €</option>
        <option value="ID35">Mondial Relay – 3 pots – 21,40 €</option>
      </select>

      <div id="paypal-FORET250" style="margin-top:12px;"></div>
    </div>

    <!-- Forêt 500g -->
    <div class="product" id="block-FORET500">
      <h3>Miel de Forêt — Pot 500g</h3>
      <img src="images/miel_foret_500.jpg" alt="Miel de Forêt 500g">
      <p class="price">7 € (500g)</p>

      <label for="FORET500">Choisir (Retrait / Colissimo / Mondial Relay)</label>
      <select id="FORET500" onchange="updateButton('FORET500')">
        <option value="">-- Sélectionnez --</option>
        <option value="ID36">Retrait – 1 pot – 7 €</option>
        <option value="ID37">Retrait – 2 pots – 14 €</option>
        <option value="ID38">Retrait – 3 pots – 21 €</option>
        <option value="ID39">Colissimo – 1 pot – 16,40 €</option>
        <option value="ID40">Colissimo – 2 pots – 27,10 €</option>
        <option value="ID41">Colissimo – 3 pots – 35,65 €</option>
        <option value="ID42">Mondial Relay – 1 pot – 12,40 €</option>
        <option value="ID43">Mondial Relay – 2 pots – 20,40 €</option>
        <option value="ID44">Mondial Relay – 3 pots – 28,40 €</option>
      </select>

      <div id="paypal-FORET500" style="margin-top:12px;"></div>
    </div>

    <!-- Forêt 1kg -->
    <div class="product" id="block-FORET1KG">
      <h3>Miel de Forêt — Pot 1kg</h3>
      <img src="images/miel_foret_1kg.jpg" alt="Miel de Forêt 1kg">
      <p class="price">13 € (1kg)</p>

      <label for="FORET1KG">Choisir (Retrait / Colissimo / Mondial Relay)</label>
      <select id="FORET1KG" onchange="updateButton('FORET1KG')">
        <option value="">-- Sélectionnez --</option>
        <option value="ID45">Retrait – 1 pot – 13 €</option>
        <option value="ID46">Retrait – 2 pots – 26 €</option>
        <option value="ID47">Retrait – 3 pots – 39 €</option>
        <option value="ID48">Colissimo – 1 pot – 26,10 €</option>
        <option value="ID49">Colissimo – 2 pots – 40,65 €</option>
        <option value="ID50">Colissimo – 3 pots – 53,65 €</option>
        <option value="ID51">Mondial Relay – 1 pot – 19,40 €</option>
        <option value="ID52">Mondial Relay – 2 pots – 33,40 €</option>
      </select>

      <div id="paypal-FORET1KG" style="margin-top:12px;"></div>
    </div>

  </div> <!-- fin .products -->
</section>

<!-- ================= FORMULAIRE DE COMMANDE ================= -->
<section>
  <div class="form">
    <h2>📝 Confirmation de votre commande</h2>
    <p class="small">Remplissez ce formulaire après votre paiement PayPal. Si vous choisissez un point relais, cliquez sur le relais dans la liste pour le sélectionner automatiquement.</p>

    <form id="orderForm" action="https://formspree.io/f/mrbajnvb" method="POST">
      <label for="customerName">Nom et prénom :</label>
      <input id="customerName" name="nom" type="text" required>

      <label for="email">Adresse email :</label>
      <input id="email" name="_replyto" type="email" required>

      <label for="phone">Téléphone :</label>
      <input id="phone" name="telephone" type="tel">

      <label for="address">Adresse postale complète (pour Colissimo) :</label>
      <textarea id="address" name="adresse" rows="3"></textarea>

      <label for="cpForm">Code postal (pour recherche relais) :</label>
      <input id="cpForm" name="cp" type="text" maxlength="5" placeholder="75001">

      <div style="margin-top:8px;">
        <button type="button" class="form-button" onclick="chercherRelais()">🔎 Rechercher les relais</button>
      </div>

      <div id="relayResults" class="relay-list" style="margin-top:12px;"></div>

      <label for="pointrelais">Point Relais choisi :</label>
      <input id="pointrelais" name="pointrelais" type="text" placeholder="Ex: 034439 - ARS INFORMATIQUE, 75001 PARIS">

      <label for="produits">Produits commandés (automatique si sélection faite)</label>
      <textarea id="produits" name="produits" rows="3" readonly placeholder="Sélectionnez vos produits ci-dessus"></textarea>

      <div style="margin-top:12px;">
        <button type="submit" class="form-button">✅ Confirmer la commande</button>
      </div>

      <p class="note">Pour de plus grandes quantités, m’envoyer un mail 📩</p>
    </form>
  </div>
</section>

<footer>
  <p>📍 Les Bordes 45460 • 📧 apilesbordes@hotmail.com • 📞 0651721612</p>
  <p>© 2025 Apilesbordes - Tous droits réservés</p>
</footer>

<!-- ================= SCRIPTS ================= -->
<script>
  /* === Mapping IDxx -> PayPal hostedButtonId === */
  const paypalIDs = {
    "ID01":"DH9HLY9ETJFY4","ID02":"V2EVFDAAVNJHL","ID03":"KSU8DPTL4D6NC",
    "ID04":"5WJ9KMY65AF5L","ID05":"6DDT8SZCQL2Z8","ID06":"G8RKH7G9WT95Y",
    "ID07":"CRN8LJEHR5RKU","ID08":"F9NVVWZTY3JUC","ID09":"KLLE7MKGE6X8L",
    "ID10":"XVV484E9L5J88","ID11":"LR5X2GYHP8JLA","ID12":"SXCTVFPL7MCNQ",
    "ID13":"775VNENGNAEDU","ID14":"P9TTVVUEKWSHU","ID15":"XRNWZB447NAZJ",
    "ID16":"D6XW2WZA7AU96","ID17":"LENQGGWVPQPNS","ID18":"5MUXDTBNX64HU",
    "ID19":"HPJS5JWGAJH2L","ID20":"JGJ6LNGEXPYVE","ID21":"75942EJVQWJYN",
    "ID22":"SR6XNDCVJ7ZNQ","ID23":"SV4RXKKW8M9ZY","ID24":"JZM9FKF638EPG",
    "ID25":"2Q5Q5TC38M7EW","ID26":"LQEBL33BSRPCE","ID27":"SD3VEEK7KLBA8",
    "ID28":"CMPHKNL52PYL4","ID29":"CCZ3ETEEQULYY","ID30":"2337EXHEWZRG2",
    "ID31":"GC97KDKHQ64RU","ID32":"YM4JPND6LTWKN","ID33":"U7JUFT42DG2Q8",
    "ID34":"MPUCYVLP886J6","ID35":"RJ66SJA3GC48A","ID36":"RBYY8K74HYSSW",
    "ID37":"FNZFYUGBTKCT6","ID38":"M3SB9FU89B6G4","ID39":"H966L25P5JWRA",
    "ID40":"LUBAANPJ4KHTW","ID41":"FKVNH874CDU6E","ID42":"Z4FWKPSCMB3FQ",
    "ID43":"5P8AQVH58GAXG","ID44":"VQ8SF4DM2QGXS","ID45":"QKHBT9AKT52AW",
    "ID46":"KFGS9H38KZPW8","ID47":"6EUEAHYBJG8AG","ID48":"YGEAXXKKKMSU8",
    "ID49":"S95WP8CY7ZPN6","ID50":"H35R5PH8B4YXA","ID51":"LEGVEK5K6TNYW",
    "ID52":"V99U9TC8JQ446"
  };

  /* === selections : stocke uniquement les choix de l'utilisateur === */
  const selections = {};

  /* updateButton : appelé UNIQUEMENT par onchange sur les selects */
  function updateButton(ref) {
    try {
      const select = document.getElementById(ref);
      if (!select) return;

      const chosenId = select.value; // ex "ID01" ou "" si -- Sélectionnez --
      const chosenText = select.options[select.selectedIndex].text;

      if (chosenId && chosenId !== "") {
        selections[ref] = chosenText; // enregistrer la sélection faite par l'utilisateur
      } else {
        delete selections[ref]; // si l'utilisateur remet "-- Sélectionnez --"
      }

      // mettre à jour la zone produits (textarea)
      const produitsEl = document.getElementById('produits');
      if (produitsEl) {
        produitsEl.value = Object.values(selections).join(' ; ');
      }

      // rendre le bouton PayPal correspondant dans le conteneur
      const containerId = 'paypal-' + ref;
      let container = document.getElementById(containerId);
      if (!container) {
        // si le conteneur n'existe pas, on en crée un juste après le select
        container = document.createElement('div');
        container.id = containerId;
        select.parentNode.insertBefore(container, select.nextSibling);
      }
      container.innerHTML = ""; // vider

      const hostedId = paypalIDs[chosenId];
      if (hostedId) {
        // render the hosted button
        paypal.HostedButtons({ hostedButtonId: hostedId }).render("#" + containerId);
      }
    } catch (e) {
      console.error("updateButton error", e);
    }
  }

  /* === Mondial Relay : recherche relais via ton NAS (mondialrelay.php) === */
  async function chercherRelais() {
    const cp = document.getElementById('cpForm').value.trim();
    const results = document.getElementById('relayResults');
    results.innerHTML = "<p>Recherche en cours…</p>";

    if (!/^[0-9]{5}$/.test(cp)) {
      results.innerHTML = "<p style='color:red;'>Merci de saisir un code postal à 5 chiffres.</p>";
      return;
    }

    try {
      const resp = await fetch(`https://apilesbordes.synology.me/mondialrelay.php?cp=${encodeURIComponent(cp)}`);
      if (!resp.ok) throw new Error("NAS inaccessible");
      const data = await resp.json();

      if (!Array.isArray(data) || data.length === 0) {
        results.innerHTML = "<p>Aucun relais trouvé.</p>";
        return;
      }

      // afficher les relais
      results.innerHTML = "";
      data.forEach(r => {
        const div = document.createElement('div');
        div.className = 'relay-item';
        div.innerHTML = `<strong>${escapeHtml(r.nom)}</strong><br>${escapeHtml(r.adresse)} — ${escapeHtml(r.cp)} ${escapeHtml(r.ville)}`;
        div.onclick = () => {
          document.getElementById('pointrelais').value = `${r.num} - ${r.nom} - ${r.adresse} ${r.cp} ${r.ville}`;
          // scroll to field
          document.getElementById('pointrelais').scrollIntoView({behavior:'smooth', block:'center'});
        };
        results.appendChild(div);
      });

    } catch (err) {
      console.error("chercherRelais error", err);
      results.innerHTML = "<p style='color:red;'>Impossible de charger la liste automatique.<br>Merci de saisir manuellement votre point relais ci-dessous :</p>";
    }
  }

  function escapeHtml(s) {
    if (!s) return '';
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  // AUCUNE initialisation automatique : tout se fait via onchange ou via le bouton "Rechercher les relais"
</script>

</body>
</html>
<!-- FIN DU FICHIER -->
