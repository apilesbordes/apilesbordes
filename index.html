<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Apilesbordes - Miel artisanal</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#fffbee; color:#333; }
    header { background:#f6c90e; padding:20px; text-align:center; font-size:28px; font-weight:700; color:#3e2f00; }
    section { padding:20px; text-align:center; }
    .products { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; }
    .product { background:#fff8d9; border-radius:12px; padding:18px; width:340px; box-shadow:0 4px 8px rgba(0,0,0,0.08); text-align:center; }
    .product img { max-width:100%; border-radius:10px; }
    .price { font-size:17px; font-weight:700; color:#3e2f00; margin:10px 0; }
    label { font-weight:700; display:block; margin-top:8px; text-align:left; }
    select, input[type=text], input[type=email], input[type=tel], textarea { width:100%; padding:8px; margin-top:6px; border:1px solid #ccc; border-radius:6px; box-sizing:border-box; }
    button, .form-button { background:#f6c90e; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:700; }
    button:hover, .form-button:hover { background:#e0b80d; }
    .form { background:#fff8d9; padding:18px; border-radius:12px; max-width:720px; margin:20px auto; text-align:left; box-shadow:0 4px 8px rgba(0,0,0,0.08); }
    .small { font-size:0.9rem; color:#666; }
    .relay-list { max-width:720px; margin:10px auto; text-align:left; }
    .relay-item { border:1px solid #ddd; padding:10px; margin:6px 0; border-radius:6px; cursor:pointer; }
    .relay-item:hover { background:#f0f0f0; }
    footer { text-align:center; padding:20px; background:#f6c90e; margin-top:20px; }
    @media (max-width:720px) {
      .products { flex-direction:column; align-items:center; }
      .product { width:92%; }
    }
  </style>
</head>
<body>

  <!-- PayPal SDK (global) -->
  <script src="https://www.paypal.com/sdk/js?client-id=BAAKdibcjfq3zIS83uVKN9R6ZokO_hZe3nKWAzIiX1Kqor-AlXWg0u_PADbEJP1nE1Oy6oRlj9wq8xaEjU&components=hosted-buttons&disable-funding=venmo&currency=EUR"></script>

  <header>🍯 Apilesbordes - Miel artisanal</header>

  <section>
    <h2>Nos miels</h2>
    <p class="small">Miels 100% naturels, récoltés avec passion en Sologne et en Forêt.</p>
  </section>

  <!-- ================= MIEL DE SOLOGNE ================= -->
  <section>
    <h2>🍯 Miel de Sologne</h2>
    <div class="products">

      <!-- Sologne 250g -->
      <div class="product">
        <h3>Miel de Sologne — Pot 250g</h3>
        <img src="images/miel_sologne_250.jpg" alt="Miel de Sologne 250g">
        <p class="price">5 € / 7 € / 13 € (selon conditionnement et livraison)</p>

        <label for="SOLOGNE250">Choisir (Retrait / Colissimo / Mondial Relay)</label>
        <select id="SOLOGNE250" onchange="updateButton('SOLOGNE250')">
          <option value="ID01">Retrait – 1 pot – 5 €</option>
          <option value="ID02">Retrait – 2 pots – 10 €</option>
          <option value="ID03">Retrait – 3 pots – 15 €</option>
          <option value="ID04">Colissimo – 1 pot – 12,35 €</option>
          <option value="ID05">Colissimo – 2 pots – 19,40 €</option>
          <option value="ID06">Colissimo – 3 pots – 28,10 €</option>
          <option value="ID07">Mondial Relay – 1 pot – 9,40 €</option>
          <option value="ID08">Mondial Relay – 2 pots – 15,40 €</option>
          <option value="ID09">Mondial Relay – 3 pots – 21,40 €</option>
        </select>

        <div id="paypal-SOLOGNE250" style="margin-top:12px;"></div>
      </div>

      <!-- Sologne 500g -->
      <div class="product">
        <h3>Miel de Sologne — Pot 500g</h3>
        <img src="images/miel_sologne_500.jpg" alt="Miel de Sologne 500g">
        <p class="price">7 € / 12,50 € / 13 € (selon conditionnement et livraison)</p>

        <label for="SOLOGNE500">Choisir (Retrait / Colissimo / Mondial Relay)</label>
        <select id="SOLOGNE500" onchange="updateButton('SOLOGNE500')">
          <option value="ID10">Retrait – 1 pot – 7 €</option>
          <option value="ID11">Retrait – 2 pots – 14 €</option>
          <option value="ID12">Retrait – 3 pots – 21 €</option>
          <option value="ID13">Colissimo – 1 pot – 16,40 €</option>
          <option value="ID14">Colissimo – 2 pots – 27,10 €</option>
          <option value="ID15">Colissimo – 3 pots – 35,65 €</option>
          <option value="ID16">Mondial Relay – 1 pot – 12,40 €</option>
          <option value="ID17">Mondial Relay – 2 pots – 20,40 €</option>
          <option value="ID18">Mondial Relay – 3 pots – 28,40 €</option>
        </select>

        <div id="paypal-SOLOGNE500" style="margin-top:12px;"></div>
      </div>

      <!-- Sologne 1kg -->
      <div class="product">
        <h3>Miel de Sologne — Pot 1kg</h3>
        <img src="images/miel_sologne_1kg.jpg" alt="Miel de Sologne 1kg">
        <p class="price">13 € / 18,50 € / 13 € (selon conditionnement et livraison)</p>

        <label for="SOLOGNE1KG">Choisir (Retrait / Colissimo / Mondial Relay)</label>
        <select id="SOLOGNE1KG" onchange="updateButton('SOLOGNE1KG')">
          <option value="ID19">Retrait – 1 pot – 13 €</option>
          <option value="ID20">Retrait – 2 pots – 26 €</option>
          <option value="ID21">Retrait – 3 pots – 39 €</option>
          <option value="ID22">Colissimo – 1 pot – 26,10 €</option>
          <option value="ID23">Colissimo – 2 pots – 40,65 €</option>
          <option value="ID24">Colissimo – 3 pots – 53,65 €</option>
          <option value="ID25">Mondial Relay – 1 pot – 19,40 €</option>
          <option value="ID26">Mondial Relay – 2 pots – 33,40 €</option>
        </select>

        <div id="paypal-SOLOGNE1KG" style="margin-top:12px;"></div>
      </div>

    </div>
  </section>

  <!-- ================= MIEL DE FORÊT ================= -->
  <section>
    <h2>🌲 Miel de Forêt</h2>
    <div class="products">

      <!-- Forêt 250g -->
      <div class="product">
        <h3>Miel de Forêt — Pot 250g</h3>
        <img src="images/miel_foret_250.jpg" alt="Miel de Forêt 250g">
        <p class="price">5 € / 12,35 € / 9,40 € (selon conditionnement et livraison)</p>

        <label for="FORET250">Choisir (Retrait / Colissimo / Mondial Relay)</label>
        <select id="FORET250" onchange="updateButton('FORET250')">
          <option value="ID27">Retrait – 1 pot – 5 €</option>
          <option value="ID28">Retrait – 2 pots – 10 €</option>
          <option value="ID29">Retrait – 3 pots – 15 €</option>
          <option value="ID30">Colissimo – 1 pot – 12,35 €</option>
          <option value="ID31">Colissimo – 2 pots – 19,40 €</option>
          <option value="ID32">Colissimo – 3 pots – 28,10 €</option>
          <option value="ID33">Mondial Relay – 1 pot – 9,40 €</option>
          <option value="ID34">Mondial Relay – 2 pots – 15,40 €</option>
          <option value="ID35">Mondial Relay – 3 pots – 21,40 €</option>
        </select>

        <div id="paypal-FORET250" style="margin-top:12px;"></div>
      </div>

      <!-- Forêt 500g -->
      <div class="product">
        <h3>Miel de Forêt — Pot 500g</h3>
        <img src="images/miel_foret_500.jpg" alt="Miel de Forêt 500g">
        <p class="price">7 € / 16,40 € / 12,40 € (selon conditionnement et livraison)</p>

        <label for="FORET500">Choisir (Retrait / Colissimo / Mondial Relay)</label>
        <select id="FORET500" onchange="updateButton('FORET500')">
          <option value="ID36">Retrait – 1 pot – 7 €</option>
          <option value="ID37">Retrait – 2 pots – 14 €</option>
          <option value="ID38">Retrait – 3 pots – 21 €</option>
          <option value="ID39">Colissimo – 1 pot – 16,40 €</option>
          <option value="ID40">Colissimo – 2 pots – 27,10 €</option>
          <option value="ID41">Colissimo – 3 pots – 35,65 €</option>
          <option value="ID42">Mondial Relay – 1 pot – 12,40 €</option>
          <option value="ID43">Mondial Relay – 2 pots – 20,40 €</option>
          <option value="ID44">Mondial Relay – 3 pots – 28,40 €</option>
        </select>

        <div id="paypal-FORET500" style="margin-top:12px;"></div>
      </div>

      <!-- Forêt 1kg -->
      <div class="product">
        <h3>Miel de Forêt — Pot 1kg</h3>
        <img src="images/miel_foret_1kg.jpg" alt="Miel de Forêt 1kg">
        <p class="price">13 € / 26,10 € / 19,40 € (selon conditionnement et livraison)</p>

        <label for="FORET1KG">Choisir (Retrait / Colissimo / Mondial Relay)</label>
        <select id="FORET1KG" onchange="updateButton('FORET1KG')">
          <option value="ID45">Retrait – 1 pot – 13 €</option>
          <option value="ID46">Retrait – 2 pots – 26 €</option>
          <option value="ID47">Retrait – 3 pots – 39 €</option>
          <option value="ID48">Colissimo – 1 pot – 26,10 €</option>
          <option value="ID49">Colissimo – 2 pots – 40,65 €</option>
          <option value="ID50">Colissimo – 3 pots – 53,65 €</option>
          <option value="ID51">Mondial Relay – 1 pot – 19,40 €</option>
          <option value="ID52">Mondial Relay – 2 pots – 33,40 €</option>
        </select>

        <div id="paypal-FORET1KG" style="margin-top:12px;"></div>
      </div>

    </div>
  </section>

  <!-- ================= FORMULAIRE DE CONFIRMATION ================= -->
  <section>
    <div class="form">
      <h2>Confirmation de votre commande</h2>
      <p class="small">Remplissez ce formulaire après votre paiement PayPal. Si vous choisissez un point relais, cliquez sur le relais dans la liste pour le sélectionner automatiquement.</p>

      <form action="https://formspree.io/f/mrbajnvb" method="POST" id="orderForm">
        <label for="customerName">Nom et prénom :</label>
        <input id="customerName" name="name" type="text" required>

        <label for="email">Adresse email :</label>
        <input id="email" name="_replyto" type="email" required>

        <label for="phone">Téléphone :</label>
        <input id="phone" name="phone" type="tel">

        <label for="address">Adresse postale complète (pour Colissimo) :</label>
        <textarea id="address" name="address" rows="3"></textarea>

        <label for="cpForm">Code postal (pour recherche relais) :</label>
        <input id="cpForm" name="cp" type="text" maxlength="5" placeholder="75001">

        <button type="button" class="form-button" onclick="loadRelaisFromForm()">🔎 Rechercher les relais</button>

        <div id="relaisContainer" class="relay-list" style="margin-top:12px;"></div>

        <label for="pointrelais">Point Relais choisi :</label>
        <input id="pointrelais" name="pointrelais" type="text" placeholder="Ex: 034439 - ARS INFORMATIQUE, 75001 PARIS">

        <label for="produits">Produits commandés (automatique si sélection faite) :</label>
        <textarea id="produits" name="produits" rows="3" required placeholder="Ex: Miel de Sologne 250g - Retrait - 1 pot"></textarea>

        <p class="small">Pour de plus grandes quantités, m’envoyer un mail 📩</p>
        <button type="submit" class="form-button">✅ Envoyer la confirmation</button>
      </form>
    </div>
  </section>

  <footer>
    <p>📍 Les Bordes 45460 • 📧 apilesbordes@hotmail.com • 📞 0651721612</p>
    <p>© 2025 Apilesbordes - Tous droits réservés</p>
  </footer>

  <!-- ================= SCRIPTS ================= -->
  <script>
    // --- Mapping des codes IDxx -> hostedButtonId PayPal (fourni par toi) ---
    const paypalIDs = {
      "ID01":"DH9HLY9ETJFY4","ID02":"V2EVFDAAVNJHL","ID03":"KSU8DPTL4D6NC",
      "ID04":"5WJ9KMY65AF5L","ID05":"6DDT8SZCQL2Z8","ID06":"G8RKH7G9WT95Y",
      "ID07":"CRN8LJEHR5RKU","ID08":"F9NVVWZTY3JUC","ID09":"KLLE7MKGE6X8L",
      "ID10":"XVV484E9L5J88","ID11":"LR5X2GYHP8JLA","ID12":"SXCTVFPL7MCNQ",
      "ID13":"775VNENGNAEDU","ID14":"P9TTVVUEKWSHU","ID15":"XRNWZB447NAZJ",
      "ID16":"D6XW2WZA7AU96","ID17":"LENQGGWVPQPNS","ID18":"5MUXDTBNX64HU",
      "ID19":"HPJS5JWGAJH2L","ID20":"JGJ6LNGEXPYVE","ID21":"75942EJVQWJYN",
      "ID22":"SR6XNDCVJ7ZNQ","ID23":"SV4RXKKW8M9ZY","ID24":"JZM9FKF638EPG",
      "ID25":"2Q5Q5TC38M7EW","ID26":"LQEBL33BSRPCE","ID27":"SD3VEEK7KLBA8",
      "ID28":"CMPHKNL52PYL4","ID29":"CCZ3ETEEQULYY","ID30":"2337EXHEWZRG2",
      "ID31":"GC97KDKHQ64RU","ID32":"YM4JPND6LTWKN","ID33":"U7JUFT42DG2Q8",
      "ID34":"MPUCYVLP886J6","ID35":"RJ66SJA3GC48A","ID36":"RBYY8K74HYSSW",
      "ID37":"FNZFYUGBTKCT6","ID38":"M3SB9FU89B6G4","ID39":"H966L25P5JWRA",
      "ID40":"LUBAANPJ4KHTW","ID41":"FKVNH874CDU6E","ID42":"Z4FWKPSCMB3FQ",
      "ID43":"5P8AQVH58GAXG","ID44":"VQ8SF4DM2QGXS","ID45":"QKHBT9AKT52AW",
      "ID46":"KFGS9H38KZPW8","ID47":"6EUEAHYBJG8AG","ID48":"YGEAXXKKKMSU8",
      "ID49":"S95WP8CY7ZPN6","ID50":"H35R5PH8B4YXA","ID51":"LEGVEK5K6TNYW",
      "ID52":"V99U9TC8JQ446"
    };

    // --- stocker les sélections de chaque produit ---
const selections = {};

// Fonction qui met à jour le bouton PayPal et la zone "produits"
function updateButton(ref, triggeredByUser = true) {
  try {
    const select = document.getElementById(ref);
    if (!select) return;

    const chosenId = select.value;
    const chosenText = select.options[select.selectedIndex].text;

    // ✅ Seulement si l’appel vient d’un vrai changement utilisateur
    if (triggeredByUser) {
      selections[ref] = chosenText;

      // ✅ remplir la zone produits seulement avec les choix faits
      const produitsEl = document.getElementById('produits');
      if (produitsEl) {
        const vals = Object.values(selections);
        produitsEl.value = vals.join(' ; ');
      }
    }

    // Rendu du bouton PayPal
    const container = document.getElementById('paypal-' + ref);
    if (container) {
      container.innerHTML = "";
      const hostedId = paypalIDs[chosenId];
      if (hostedId) {
        paypal.HostedButtons({ hostedButtonId: hostedId }).render("#" + container.id);
      }
    }
  } catch (e) {
    console.error("updateButton error", e);
  }
}


    // Initialisation: rendre un bouton par produit (selon option par défaut)
    window.addEventListener('load', () => {
      const selects = ["SOLOGNE250","SOLOGNE500","SOLOGNE1KG","FORET250","FORET500","FORET1KG"];
      selects.forEach(id => {
        const el = document.getElementById(id);
        if (el) updateButton(id);
      });
    });

    // --- Mondial Relay: récupération et affichage des relais --- 
    async function loadRelaisFromForm() {
      const cp = document.getElementById('cpForm')?.value || document.getElementById('cpForm')?.defaultValue || document.getElementById('cpForm')?.placeholder;
      // prefer input in this form
      const cpInput = document.getElementById('cpForm') || document.getElementById('cpForm') // maybe missing; we'll use cpForm id if user used it
      // Instead use cpForm id from our form input
      const cpValue = document.getElementById('cpForm') ? document.getElementById('cpForm').value.trim() : document.getElementById('cpForm')?.placeholder || document.getElementById('cpForm')?.value || document.getElementById('cp')?.value || '';

      const cpToUse = (document.getElementById('cpForm') && document.getElementById('cpForm').value.trim()) ||
                      (document.getElementById('cp') && document.getElementById('cp').value.trim()) ||
                      (document.getElementById('cpForm') && document.getElementById('cpForm').placeholder) ||
                      '';

      if (!/^[0-9]{5}$/.test(cpToUse)) {
        alert("Merci de saisir un code postal valide à 5 chiffres.");
        return;
      }

      const container = document.getElementById('relaisContainer');
      container.innerHTML = "Recherche en cours…";

      try {
        const resp = await fetch(`https://apilesbordes.synology.me/mondialrelay.php?cp=${encodeURIComponent(cpToUse)}`);
        if (!resp.ok) throw new Error("NAS inaccessible");
        const data = await resp.json();

        if (!Array.isArray(data) || data.length === 0) {
          container.innerHTML = "<b>Aucun relais trouvé.</b>";
          return;
        }

        // afficher la liste et permettre de cliquer -> remplir champ pointrelais
        container.innerHTML = "";
        data.forEach(pr => {
          const div = document.createElement('div');
          div.className = 'relay-item';
          div.innerHTML = `<strong>${escapeHtml(pr.nom)}</strong><br>${escapeHtml(pr.adresse)} ${escapeHtml(pr.cp)} ${escapeHtml(pr.ville)}`;
          div.addEventListener('click', () => {
            document.getElementById('pointrelais').value = `${pr.num} - ${pr.nom} - ${pr.adresse} ${pr.cp} ${pr.ville}`;
            // scroll to form field
            document.getElementById('pointrelais').scrollIntoView({behavior:'smooth', block:'center'});
          });
          container.appendChild(div);
        });

      } catch (err) {
        console.error(err);
        container.innerHTML = "<b>❌ Impossible de charger la liste automatique. Saisissez manuellement ci-dessous.</b>";
      }
    }

    // utilitaire pour échapper
    function escapeHtml(s) {
      if (!s) return '';
      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

  </script>

</body>
</html>
