<!-- PARTIE 1/2 - coller ceci en premier dans votre bloc-note -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Apilesbordes - Miel artisanal</title>

  <!-- Styles -->
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#fffbee; color:#333; }
    header { background:#f6c90e; padding:20px; text-align:center; font-size:28px; font-weight:700; color:#3e2f00; }
    section { padding:18px; text-align:center; }
    .products { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; }
    .product { background:#fff8d9; border-radius:12px; padding:18px; width:340px; box-shadow:0 4px 8px rgba(0,0,0,0.08); text-align:center; }
    .product img { max-width:100%; border-radius:10px; }
    .price { font-size:16px; font-weight:700; color:#3e2f00; margin:10px 0; }
    label { font-weight:700; display:block; margin-top:8px; text-align:left; }
    select, input[type=text], input[type=email], input[type=tel], textarea { width:100%; padding:8px; margin-top:6px; border:1px solid #ccc; border-radius:6px; box-sizing:border-box; }
    button, .form-button { background:#f6c90e; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:700; }
    button:hover, .form-button:hover { background:#e0b80d; }
    .form { background:#fff8d9; padding:18px; border-radius:12px; max-width:820px; margin:20px auto; text-align:left; box-shadow:0 4px 8px rgba(0,0,0,0.08); }
    .small { font-size:0.9rem; color:#666; }
    .relay-list { max-width:820px; margin:10px auto; text-align:left; }
    .relay-item { border:1px solid #ddd; padding:10px; margin:6px 0; border-radius:6px; cursor:pointer; }
    .relay-item:hover { background:#f0f0f0; }
    footer { text-align:center; padding:20px; background:#f6c90e; margin-top:20px; }
    .form-note { font-style:italic; color:#a00; margin-top:10px; }
    @media (max-width:800px) {
      .products { flex-direction:column; align-items:center; }
      .product { width:92%; }
    }
  </style>

  <!-- PayPal SDK (global) -->
  <script src="https://www.paypal.com/sdk/js?client-id=BAAKdibcjfq3zIS83uVKN9R6ZokO_hZe3nKWAzIiX1Kqor-AlXWg0u_PADbEJP1nE1Oy6oRlj9wq8xaEjU&components=hosted-buttons&disable-funding=venmo&currency=EUR"></script>
</head>
<body>

<header>üçØ Apilesbordes - Miel artisanal</header>

<section>
  <h2>Nos miels</h2>
  <p class="small">Miels 100% naturels, r√©colt√©s avec passion en Sologne et en For√™t.</p>
</section>

<!-- ================= MIEL DE SOLOGNE ================= -->
<section>
  <h2>üçØ Miel de Sologne</h2>
  <div class="products">

    <!-- Sologne 250g -->
    <div class="product" id="block-SOLOGNE250">
      <h3>Miel de Sologne ‚Äî Pot 250g</h3>
      <img src="images/miel_sologne_250.jpg" alt="Miel de Sologne 250g">
      <p class="price">5 ‚Ç¨ (250g)</p>

      <label for="SOLOGNE250">Choisir (Retrait/Colissimo/Mondial Relay)</label>
      <select id="SOLOGNE250" onchange="updateButton('SOLOGNE250')">
        <option value="">-- S√©lectionnez --</option>
        <option value="ID01">Retrait ‚Äì 1 pot ‚Äì 5 ‚Ç¨</option>
        <option value="ID02">Retrait ‚Äì 2 pots ‚Äì 10 ‚Ç¨</option>
        <option value="ID03">Retrait ‚Äì 3 pots ‚Äì 15 ‚Ç¨</option>
        <option value="ID04">Colissimo ‚Äì 1 pot ‚Äì 12,35 ‚Ç¨</option>
        <option value="ID05">Colissimo ‚Äì 2 pots ‚Äì 19,40 ‚Ç¨</option>
        <option value="ID06">Colissimo ‚Äì 3 pots ‚Äì 28,10 ‚Ç¨</option>
        <option value="ID07">Mondial Relay ‚Äì 1 pot ‚Äì 9,40 ‚Ç¨</option>
        <option value="ID08">Mondial Relay ‚Äì 2 pots ‚Äì 15,40 ‚Ç¨</option>
        <option value="ID09">Mondial Relay ‚Äì 3 pots ‚Äì 21,40 ‚Ç¨</option>
      </select>

      <div id="paypal-SOLOGNE250" style="margin-top:12px;"></div>
    </div>

    <!-- Sologne 500g -->
    <div class="product" id="block-SOLOGNE500">
      <h3>Miel de Sologne ‚Äî Pot 500g</h3>
      <img src="images/miel_sologne_500.jpg" alt="Miel de Sologne 500g">
      <p class="price">7 ‚Ç¨ (500g)</p>

      <label for="SOLOGNE500">Choisir (Retrait/Colissimo/Mondial Relay)</label>
      <select id="SOLOGNE500" onchange="updateButton('SOLOGNE500')">
        <option value="">-- S√©lectionnez --</option>
        <option value="ID10">Retrait ‚Äì 1 pot ‚Äì 7 ‚Ç¨</option>
        <option value="ID11">Retrait ‚Äì 2 pots ‚Äì 14 ‚Ç¨</option>
        <option value="ID12">Retrait ‚Äì 3 pots ‚Äì 21 ‚Ç¨</option>
        <option value="ID13">Colissimo ‚Äì 1 pot ‚Äì 16,40 ‚Ç¨</option>
        <option value="ID14">Colissimo ‚Äì 2 pots ‚Äì 27,10 ‚Ç¨</option>
        <option value="ID15">Colissimo ‚Äì 3 pots ‚Äì 35,65 ‚Ç¨</option>
        <option value="ID16">Mondial Relay ‚Äì 1 pot ‚Äì 12,40 ‚Ç¨</option>
        <option value="ID17">Mondial Relay ‚Äì 2 pots ‚Äì 20,40 ‚Ç¨</option>
        <option value="ID18">Mondial Relay ‚Äì 3 pots ‚Äì 28,40 ‚Ç¨</option>
      </select>

      <div id="paypal-SOLOGNE500" style="margin-top:12px;"></div>
    </div>

    <!-- Sologne 1kg -->
    <div class="product" id="block-SOLOGNE1KG">
      <h3>Miel de Sologne ‚Äî Pot 1kg</h3>
      <img src="images/miel_sologne_1kg.jpg" alt="Miel de Sologne 1kg">
      <p class="price">13 ‚Ç¨ (1kg)</p>

      <label for="SOLOGNE1KG">Choisir (Retrait/Colissimo/Mondial Relay)</label>
      <select id="SOLOGNE1KG" onchange="updateButton('SOLOGNE1KG')">
        <option value="">-- S√©lectionnez --</option>
        <option value="ID19">Retrait ‚Äì 1 pot ‚Äì 13 ‚Ç¨</option>
        <option value="ID20">Retrait ‚Äì 2 pots ‚Äì 26 ‚Ç¨</option>
        <option value="ID21">Retrait ‚Äì 3 pots ‚Äì 39 ‚Ç¨</option>
        <option value="ID22">Colissimo ‚Äì 1 pot ‚Äì 26,10 ‚Ç¨</option>
        <option value="ID23">Colissimo ‚Äì 2 pots ‚Äì 40,65 ‚Ç¨</option>
        <option value="ID24">Colissimo ‚Äì 3 pots ‚Äì 53,65 ‚Ç¨</option>
        <option value="ID25">Mondial Relay ‚Äì 1 pot ‚Äì 19,40 ‚Ç¨</option>
        <option value="ID26">Mondial Relay ‚Äì 2 pots ‚Äì 33,40 ‚Ç¨</option>
      </select>

      <div id="paypal-SOLOGNE1KG" style="margin-top:12px;"></div>
    </div>

  </div>
</section>

<!-- ================= MIEL DE FOR√äT (d√©but) ================= -->
<section>
  <h2>üå≤ Miel de For√™t</h2>
  <div class="products">

    <!-- For√™t 250g -->
    <div class="product" id="block-FORET250">
      <h3>Miel de For√™t ‚Äî Pot 250g</h3>
      <img src="images/miel_foret_250.jpg" alt="Miel de For√™t 250g">
      <p class="price">5 ‚Ç¨ (250g)</p>

      <label for="FORET250">Choisir (Retrait/Colissimo/Mondial Relay)</label>
      <select id="FORET250" onchange="updateButton('FORET250')">
        <option value="">-- S√©lectionnez --</option>
        <option value="ID27">Retrait ‚Äì 1 pot ‚Äì 5 ‚Ç¨</option>
        <option value="ID28">Retrait ‚Äì 2 pots ‚Äì 10 ‚Ç¨</option>
        <option value="ID29">Retrait ‚Äì 3 pots ‚Äì 15 ‚Ç¨</option>
        <option value="ID30">Colissimo ‚Äì 1 pot ‚Äì 12,35 ‚Ç¨</option>
        <option value="ID31">Colissimo ‚Äì 2 pots ‚Äì 19,40 ‚Ç¨</option>
        <option value="ID32">Colissimo ‚Äì 3 pots ‚Äì 28,10 ‚Ç¨</option>
        <option value="ID33">Mondial Relay ‚Äì 1 pot ‚Äì 9,40 ‚Ç¨</option>
        <option value="ID34">Mondial Relay ‚Äì 2 pots ‚Äì 15,40 ‚Ç¨</option>
        <option value="ID35">Mondial Relay ‚Äì 3 pots ‚Äì 21,40 ‚Ç¨</option>
      </select>

      <div id="paypal-FORET250" style="margin-top:12px;"></div>
    </div>

    <!-- For√™t 500g -->
    <div class="product" id="block-FORET500">
      <h3>Miel de For√™t ‚Äî Pot 500g</h3>
      <img src="images/miel_foret_500.jpg" alt="Miel de For√™t 500g">
      <p class="price">7 ‚Ç¨ (500g)</p>

      <label for="FORET500">Choisir (Retrait/Colissimo/Mondial Relay)</label>
      <select id="FORET500" onchange="updateButton('FORET500')">
        <option value="">-- S√©lectionnez --</option>
        <option value="ID36">Retrait ‚Äì 1 pot ‚Äì 7 ‚Ç¨</option>
        <option value="ID37">Retrait ‚Äì 2 pots ‚Äì 14 ‚Ç¨</option>
        <option value="ID38">Retrait ‚Äì 3 pots ‚Äì 21 ‚Ç¨</option>
        <option value="ID39">Colissimo ‚Äì 1 pot ‚Äì 16,40 ‚Ç¨</option>
        <option value="ID40">Colissimo ‚Äì 2 pots ‚Äì 27,10 ‚Ç¨</option>
        <option value="ID41">Colissimo ‚Äì 3 pots ‚Äì 35,65 ‚Ç¨</option>
        <option value="ID42">Mondial Relay ‚Äì 1 pot ‚Äì 12,40 ‚Ç¨</option>
        <option value="ID43">Mondial Relay ‚Äì 2 pots ‚Äì 20,40 ‚Ç¨</option>
        <option value="ID44">Mondial Relay ‚Äì 3 pots ‚Äì 28,40 ‚Ç¨</option>
      </select>

      <div id="paypal-FORET500" style="margin-top:12px;"></div>
    </div>

    <!-- FIN DE LA PARTIE 1/2 : la suite (For√™t 1kg + formulaire + footer + balises) est dans la PARTIE 2/2 -->
  </div>
</section>

<!-- ================= SCRIPTS (mapping + fonctions) ================= -->
<script>
  // Mapping complet IDxx -> PayPal hostedButtonId (tous les IDs fournis)
  const paypalIDs = {
    "ID01":"DH9HLY9ETJFY4","ID02":"V2EVFDAAVNJHL","ID03":"KSU8DPTL4D6NC",
    "ID04":"5WJ9KMY65AF5L","ID05":"6DDT8SZCQL2Z8","ID06":"G8RKH7G9WT95Y",
    "ID07":"CRN8LJEHR5RKU","ID08":"F9NVVWZTY3JUC","ID09":"KLLE7MKGE6X8L",
    "ID10":"XVV484E9L5J88","ID11":"LR5X2GYHP8JLA","ID12":"SXCTVFPL7MCNQ",
    "ID13":"775VNENGNAEDU","ID14":"P9TTVVUEKWSHU","ID15":"XRNWZB447NAZJ",
    "ID16":"D6XW2WZA7AU96","ID17":"LENQGGWVPQPNS","ID18":"5MUXDTBNX64HU",
    "ID19":"HPJS5JWGAJH2L","ID20":"JGJ6LNGEXPYVE","ID21":"75942EJVQWJYN",
    "ID22":"SR6XNDCVJ7ZNQ","ID23":"SV4RXKKW8M9ZY","ID24":"JZM9FKF638EPG",
    "ID25":"2Q5Q5TC38M7EW","ID26":"LQEBL33BSRPCE","ID27":"SD3VEEK7KLBA8",
    "ID28":"CMPHKNL52PYL4","ID29":"CCZ3ETEEQULYY","ID30":"2337EXHEWZRG2",
    "ID31":"GC97KDKHQ64RU","ID32":"YM4JPND6LTWKN","ID33":"U7JUFT42DG2Q8",
    "ID34":"MPUCYVLP886J6","ID35":"RJ66SJA3GC48A","ID36":"RBYY8K74HYSSW",
    "ID37":"FNZFYUGBTKCT6","ID38":"M3SB9FU89B6G4","ID39":"H966L25P5JWRA",
    "ID40":"LUBAANPJ4KHTW","ID41":"FKVNH874CDU6E","ID42":"Z4FWKPSCMB3FQ",
    "ID43":"5P8AQVH58GAXG","ID44":"VQ8SF4DM2QGXS","ID45":"QKHBT9AKT52AW",
    "ID46":"KFGS9H38KZPW8","ID47":"6EUEAHYBJG8AG","ID48":"YGEAXXKKKMSU8",
    "ID49":"S95WP8CY7ZPN6","ID50":"H35R5PH8B4YXA","ID51":"LEGVEK5K6TNYW",
    "ID52":"V99U9TC8JQ446"
  };

  // stockage des s√©lections actuelles (vide au d√©part)
  const selections = {};

  // updateButton : appel√© UNIQUEMENT par onchange des selects (aucun appel auto au chargement)
  function updateButton(ref) {
    try {
      const select = document.getElementById(ref);
      if (!select) return;

      const chosenId = select.value; // ex "ID01" ou "" si -- S√©lectionnez --
      const chosenText = select.options[select.selectedIndex].text;

      if (chosenId && chosenId !== "") {
        selections[ref] = chosenText; // enregistrer la s√©lection du produit
      } else {
        delete selections[ref]; // suppression si le client r√©initialise √† "-- S√©lectionnez --"
      }

      // mettre √† jour la zone produits (textarea qui sera dans la PARTIE 2)
      const produitsEl = document.getElementById('produits');
      if (produitsEl) {
        produitsEl.value = Object.values(selections).join(' ; ');
      }

      // render PayPal Hosted Button dans le conteneur
      const container = document.getElementById('paypal-' + ref);
      if (container) {
        container.innerHTML = "";
        const hostedId = paypalIDs[chosenId];
        if (hostedId) {
          paypal.HostedButtons({ hostedButtonId: hostedId }).render("#" + container.id);
        }
      }
    } catch (e) {
      console.error("updateButton error", e);
    }
  }

  <?php
// Autoriser les appels depuis l'ext√©rieur (GitHub Pages, etc.)
header("Access-Control-Allow-Origin: *");
header("Access-Control-Allow-Methods: GET, POST, OPTIONS");
header("Access-Control-Allow-Headers: Content-Type");
header("Content-Type: application/json; charset=UTF-8");

// Config Mondial Relay
$login = "BDTEST13";  // ton identifiant
$password = "PrivateK"; // ton mot de passe
$enseigne = "CC______41"; // ton enseigne Mondial Relay
$codePostal = isset($_GET['cp']) ? $_GET['cp'] : '75001';

// G√©n√©ration de la cl√© de s√©curit√©
$privateKey = $password;
$params = $enseigne.$codePostal."FR".$privateKey;
$security = strtoupper(md5($params));

// Corps de la requ√™te SOAP
$xmlRequest = <<<XML
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
  <soap:Body>
    <WSI3_PointRelais_Recherche xmlns="http://www.mondialrelay.fr/webservice/">
      <Enseigne>{$enseigne}</Enseigne>
      <Pays>FR</Pays>
      <CP>{$codePostal}</CP>
      <NombreResultats>10</NombreResultats>
      <Security>{$security}</Security>
    </WSI3_PointRelais_Recherche>
  </soap:Body>
</soap:Envelope>
XML;

// Envoi de la requ√™te SOAP
$url = "https://api.mondialrelay.com/Web_Services.asmx";
$ch = curl_init($url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    "Content-Type: text/xml; charset=utf-8",
    "SOAPAction: \"http://www.mondialrelay.fr/webservice/WSI3_PointRelais_Recherche\"",
    "Content-Length: " . strlen($xmlRequest)
]);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, $xmlRequest);
$response = curl_exec($ch);

if ($response === false) {
    echo json_encode(["error" => "Impossible de contacter Mondial Relay"]);
    exit;
}
curl_close($ch);

// Conversion XML ‚Üí objet
libxml_use_internal_errors(true);
$xml = simplexml_load_string($response);
if (!$xml) {
    echo json_encode([
        "error" => "R√©ponse XML invalide",
        "debug" => $response
    ]);
    exit;
}

// Extraire les r√©sultats
$ns = $xml->getNamespaces(true);
$body = $xml->children($ns['soap'])->Body;
$result = $body->children($ns[''])->WSI3_PointRelais_RechercheResponse
               ->WSI3_PointRelais_RechercheResult;

$points = [];
if (isset($result->PointsRelais->PointRelais_Details)) {
    foreach ($result->PointsRelais->PointRelais_Details as $pr) {
        $points[] = [
            "num" => (string)$pr->Num,
            "nom" => (string)$pr->LgAdr1,
            "adresse" => (string)$pr->LgAdr3,
            "cp" => (string)$pr->CP,
            "ville" => (string)$pr->Ville,
            "pays" => (string)$pr->Pays,
            "latitude" => str_replace(",", ".", (string)$pr->Latitude),
            "longitude" => str_replace(",", ".", (string)$pr->Longitude),
        ];
    }
}

echo json_encode($points, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);


  // Fonction d'affichage simple (utilis√©e dans PARTIE 2)
  function renderRelaisList(containerId, relaisArray) {
    const container = document.getElementById(containerId);
    if (!container) return;
    container.innerHTML = "";
    if (!Array.isArray(relaisArray) || relaisArray.length === 0) {
      container.innerHTML = "<p><b>Aucun relais trouv√©.</b></p>";
      return;
    }
    relaisArray.forEach(r => {
      const div = document.createElement('div');
      div.className = "relay-item";
      div.innerHTML = `<strong>${escapeHtml(r.nom)}</strong><br>${escapeHtml(r.adresse)} ${escapeHtml(r.cp)} ${escapeHtml(r.ville)}`;
      div.onclick = () => {
        const pointField = document.getElementById('pointrelais');
        if (pointField) {
          pointField.value = `${r.num} - ${r.nom} - ${r.adresse} ${r.cp} ${r.ville}`;
          pointField.scrollIntoView({behavior:'smooth', block:'center'});
        }
      };
      container.appendChild(div);
    });
  }

  function escapeHtml(s) {
    if (!s) return '';
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  // NOTE: aucune initialisation automatique ici ‚Äî tout se fait via onchange et via les boutons du formulaire.
</script>

<!-- PARTIE 2/2 - √† coller apr√®s la PARTIE 1 -->
    <!-- For√™t 1kg -->
    <div class="product" id="block-FORET1KG">
      <h3>Miel de For√™t ‚Äî Pot 1kg</h3>
      <img src="images/miel_foret_1kg.jpg" alt="Miel de For√™t 1kg">
      <p class="price">13 ‚Ç¨ (1kg)</p>

      <label for="FORET1KG">Choisir (Retrait/Colissimo/Mondial Relay)</label>
      <select id="FORET1KG" onchange="updateButton('FORET1KG')">
        <option value="">-- S√©lectionnez --</option>
        <option value="ID45">Retrait ‚Äì 1 pot ‚Äì 13 ‚Ç¨</option>
        <option value="ID46">Retrait ‚Äì 2 pots ‚Äì 26 ‚Ç¨</option>
        <option value="ID47">Retrait ‚Äì 3 pots ‚Äì 39 ‚Ç¨</option>
        <option value="ID48">Colissimo ‚Äì 1 pot ‚Äì 26,10 ‚Ç¨</option>
        <option value="ID49">Colissimo ‚Äì 2 pots ‚Äì 40,65 ‚Ç¨</option>
        <option value="ID50">Colissimo ‚Äì 3 pots ‚Äì 53,65 ‚Ç¨</option>
        <option value="ID51">Mondial Relay ‚Äì 1 pot ‚Äì 19,40 ‚Ç¨</option>
        <option value="ID52">Mondial Relay ‚Äì 2 pots ‚Äì 33,40 ‚Ç¨</option>
      </select>

      <div id="paypal-FORET1KG" style="margin-top:12px;"></div>
    </div>

  </div> <!-- fin .products -->
</section>

<!-- ================= FORMULAIRE DE COMMANDE ================= -->
<section>
  <h2>üìù Confirmation de votre commande</h2>
  <form class="form" action="https://formspree.io/f/mrbajnvb" method="POST">
    <label for="nom">Nom et pr√©nom</label>
    <input type="text" id="nom" name="nom" required>

    <label for="email">Votre e-mail</label>
    <input type="email" id="email" name="_replyto" required>

    <label for="telephone">T√©l√©phone</label>
    <input type="tel" id="telephone" name="telephone">

    <label for="adresse">Adresse postale (si livraison)</label>
    <textarea id="adresse" name="adresse"></textarea>

    <label for="cp">Code postal</label>
    <input type="text" id="cp" name="cp" maxlength="5">

    <label for="produits">Produits command√©s (automatique si s√©lection faite)</label>
    <textarea id="produits" name="produits" rows="3" readonly></textarea>

    <label for="pointrelais">Point Relais choisi</label>
    <input type="text" id="pointrelais" name="pointrelais" placeholder="Cliquez sur un relais ci-dessous ou saisissez manuellement">

    <div style="margin-top:10px;">
      <button type="button" class="form-button" onclick="chercherRelais()">üîé Rechercher un Point Relais</button>
    </div>

    <div id="relayResults" class="relay-list"></div>

    <div style="margin-top:16px;">
      <button type="submit" class="form-button">‚úÖ Confirmer la commande</button>
    </div>

    <p class="form-note">üí° Pour de plus grandes quantit√©s, merci de m‚Äôenvoyer un mail üì©</p>
  </form>
</section>

<footer>
  ¬© 2025 Apilesbordes - Tous droits r√©serv√©s ‚Äî üìû 06 51 72 16 12
</footer>

<!-- Script sp√©cifique recherche relais -->
<script>
  async function chercherRelais() {
    const cp = document.getElementById('cp').value.trim();
    const resDiv = document.getElementById('relayResults');
    resDiv.innerHTML = "<p>Recherche en cours...</p>";
    try {
      const relais = await fetchRelais(cp);
      if (relais.error) {
        resDiv.innerHTML = "<p>Impossible de charger la liste automatique.<br>Merci de saisir manuellement votre point relais ci-dessous :</p>";
      } else {
        renderRelaisList('relayResults', relais);
      }
    } catch (e) {
      resDiv.innerHTML = "<p>Impossible de charger la liste automatique.<br>Merci de saisir manuellement votre point relais ci-dessous :</p>";
    }
  }
</script>

</body>
</html>
<!-- FIN PARTIE 2/2 -->
