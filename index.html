<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Apilesbordes - Commande de Miel</title>
  <script src="https://www.paypal.com/sdk/js?client-id=sb&components=hosted-buttons&disable-funding=credit,card"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1, h2 { color: #5a381e; }
    .product-block { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 10px; }
    label { display: block; margin-top: 10px; }
    select { padding: 5px; margin-top: 5px; }
    textarea, input { width: 100%; padding: 8px; margin-top: 5px; }
    button { padding: 10px 15px; margin-top: 10px; background-color: #5a381e; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background-color: #7a4f2a; }
    #relais-list { margin-top: 10px; padding: 10px; border: 1px solid #ccc; max-height: 200px; overflow-y: auto; }
    .relais-item { padding: 5px; cursor: pointer; }
    .relais-item:hover { background: #f0f0f0; }
  </style>
</head>
<body>

<h1>Apilesbordes - Commande de Miel</h1>

<form action="https://formspree.io/f/mrbajnvb" method="POST">
  
  <!-- ================= SOLOGNE 250g ================= -->
  <h2>Miel de Sologne – 250g</h2>
  <div class="product-block">
    <label>Choisissez votre option :</label>
    <select id="SOLOGNE250" onchange="updateButton('SOLOGNE250')">
      <option value="">-- Sélectionnez --</option>
      <option value="ID01">Retrait – 1 pot – 5 €</option>
      <option value="ID02">Retrait – 2 pots – 10 €</option>
      <option value="ID03">Retrait – 3 pots – 15 €</option>
      <option value="ID04">Colissimo – 1 pot – 12,35 €</option>
      <option value="ID05">Colissimo – 2 pots – 19,40 €</option>
      <option value="ID06">Colissimo – 3 pots – 28,10 €</option>
      <option value="ID07">Mondial Relay – 1 pot – 9,40 €</option>
      <option value="ID08">Mondial Relay – 2 pots – 15,40 €</option>
      <option value="ID09">Mondial Relay – 3 pots – 21,40 €</option>
    </select>
    <div id="paypal-SOLOGNE250"></div>
  </div>

  <!-- ================= SOLOGNE 500g ================= -->
  <h2>Miel de Sologne – 500g</h2>
  <div class="product-block">
    <label>Choisissez votre option :</label>
    <select id="SOLOGNE500" onchange="updateButton('SOLOGNE500')">
      <option value="">-- Sélectionnez --</option>
      <option value="ID10">Retrait – 1 pot – 7 €</option>
      <option value="ID11">Retrait – 2 pots – 14 €</option>
      <option value="ID12">Retrait – 3 pots – 21 €</option>
      <option value="ID13">Colissimo – 1 pot – 16,40 €</option>
      <option value="ID14">Colissimo – 2 pots – 27,10 €</option>
      <option value="ID15">Colissimo – 3 pots – 35,65 €</option>
      <option value="ID16">Mondial Relay – 1 pot – 12,40 €</option>
      <option value="ID17">Mondial Relay – 2 pots – 20,40 €</option>
      <option value="ID18">Mondial Relay – 3 pots – 28,40 €</option>
    </select>
    <div id="paypal-SOLOGNE500"></div>
  </div>

  <!-- ================= SOLOGNE 1kg ================= -->
  <h2>Miel de Sologne – 1kg</h2>
  <div class="product-block">
    <label>Choisissez votre option :</label>
    <select id="SOLOGNE1KG" onchange="updateButton('SOLOGNE1KG')">
      <option value="">-- Sélectionnez --</option>
      <option value="ID19">Retrait – 1 pot – 13 €</option>
      <option value="ID20">Retrait – 2 pots – 26 €</option>
      <option value="ID21">Retrait – 3 pots – 39 €</option>
      <option value="ID22">Colissimo – 1 pot – 26,10 €</option>
      <option value="ID23">Colissimo – 2 pots – 40,65 €</option>
      <option value="ID24">Colissimo – 3 pots – 53,65 €</option>
      <option value="ID25">Mondial Relay – 1 pot – 19,40 €</option>
      <option value="ID26">Mondial Relay – 2 pots – 33,40 €</option>
    </select>
    <div id="paypal-SOLOGNE1KG"></div>
  </div>

  <!-- ================= FORET 250g ================= -->
  <h2>Miel de Forêt – 250g</h2>
  <div class="product-block">
    <label>Choisissez votre option :</label>
    <select id="FORET250" onchange="updateButton('FORET250')">
      <option value="">-- Sélectionnez --</option>
      <option value="ID27">Retrait – 1 pot – 5 €</option>
      <option value="ID28">Retrait – 2 pots – 10 €</option>
      <option value="ID29">Retrait – 3 pots – 15 €</option>
      <option value="ID30">Colissimo – 1 pot – 12,35 €</option>
      <option value="ID31">Colissimo – 2 pots – 19,40 €</option>
      <option value="ID32">Colissimo – 3 pots – 28,10 €</option>
      <option value="ID33">Mondial Relay – 1 pot – 9,40 €</option>
      <option value="ID34">Mondial Relay – 2 pots – 15,40 €</option>
      <option value="ID35">Mondial Relay – 3 pots – 21,40 €</option>
    </select>
    <div id="paypal-FORET250"></div>
  </div>

  <!-- ================= FORET 500g ================= -->
  <h2>Miel de Forêt – 500g</h2>
  <div class="product-block">
    <label>Choisissez votre option :</label>
    <select id="FORET500" onchange="updateButton('FORET500')">
      <option value="">-- Sélectionnez --</option>
      <option value="ID36">Retrait – 1 pot – 7 €</option>
      <option value="ID37">Retrait – 2 pots – 14 €</option>
      <option value="ID38">Retrait – 3 pots – 21 €</option>
      <option value="ID39">Colissimo – 1 pot – 16,40 €</option>
      <option value="ID40">Colissimo – 2 pots – 27,10 €</option>
      <option value="ID41">Colissimo – 3 pots – 35,65 €</option>
      <option value="ID42">Mondial Relay – 1 pot – 12,40 €</option>
      <option value="ID43">Mondial Relay – 2 pots – 20,40 €</option>
      <option value="ID44">Mondial Relay – 3 pots – 28,40 €</option>
    </select>
    <div id="paypal-FORET500"></div>
  </div>

  <!-- ================= FORET 1kg ================= -->
  <h2>Miel de Forêt – 1kg</h2>
  <div class="product-block">
    <label>Choisissez votre option :</label>
    <select id="FORET1KG" onchange="updateButton('FORET1KG')">
      <option value="">-- Sélectionnez --</option>
      <option value="ID45">Retrait – 1 pot – 13 €</option>
      <option value="ID46">Retrait – 2 pots – 26 €</option>
      <option value="ID47">Retrait – 3 pots – 39 €</option>
      <option value="ID48">Colissimo – 1 pot – 26,10 €</option>
      <option value="ID49">Colissimo – 2 pots – 40,65 €</option>
      <option value="ID50">Colissimo – 3 pots – 53,65 €</option>
      <option value="ID51">Mondial Relay – 1 pot – 19,40 €</option>
      <option value="ID52">Mondial Relay – 2 pots – 33,40 €</option>
    </select>
    <div id="paypal-FORET1KG"></div>
  </div>

  <!-- ================= FORMULAIRE ================= -->
  <h2>Vos coordonnées</h2>
  <label>Nom :</label>
  <input type="text" name="nom" required>
  
  <label>Prénom :</label>
  <input type="text" name="prenom" required>
  
  <label>Email :</label>
  <input type="email" name="email" required>
  
  <label>Adresse postale :</label>
  <textarea name="adresse" required></textarea>

  <label>Code postal :</label>
  <input type="text" id="cp" name="cp" required onblur="loadRelais()">

  <label>Ville :</label>
  <input type="text" name="ville" required>

  <label>Point Relais choisi :</label>
  <input type="text" id="pointrelais" name="pointrelais" placeholder="Sélectionnez ou saisissez manuellement">

  <div id="relais-list"></div>

  <label>Produits commandés (automatique si sélection faite) :</label>
  <textarea id="produits" name="produits" readonly></textarea>

  <button type="submit">✅ Confirmer ma commande</button>
</form>

<script>
  // Dictionnaire IDs PayPal
  const paypalIDs = {
    "ID01":"DH9HLY9ETJFY4","ID02":"V2EVFDAAVNJHL","ID03":"KSU8DPTL4D6NC","ID04":"5WJ9KMY65AF5L","ID05":"6DDT8SZCQL2Z8","ID06":"G8RKH7G9WT95Y","ID07":"CRN8LJEHR5RKU","ID08":"F9NVVWZTY3JUC","ID09":"KLLE7MKGE6X8L",
    "ID10":"XVV484E9L5J88","ID11":"LR5X2GYHP8JLA","ID12":"SXCTVFPL7MCNQ","ID13":"775VNENGNAEDU","ID14":"P9TTVVUEKWSHU","ID15":"XRNWZB447NAZJ","ID16":"D6XW2WZA7AU96","ID17":"LENQGGWVPQPNS","ID18":"5MUXDTBNX64HU",
    "ID19":"HPJS5JWGAJH2L","ID20":"JGJ6LNGEXPYVE","ID21":"75942EJVQWJYN","ID22":"SR6XNDCVJ7ZNQ","ID23":"SV4RXKKW8M9ZY","ID24":"JZM9FKF638EPG","ID25":"2Q5Q5TC38M7EW","ID26":"LQEBL33BSRPCE",
    "ID27":"SD3VEEK7KLBA8","ID28":"CMPHKNL52PYL4","ID29":"CCZ3ETEEQULYY","ID30":"2337EXHEWZRG2","ID31":"GC97KDKHQ64RU","ID32":"YM4JPND6LTWKN","ID33":"U7JUFT42DG2Q8","ID34":"MPUCYVLP886J6","ID35":"RJ66SJA3GC48A",
    "ID36":"RBYY8K74HYSSW","ID37":"FNZFYUGBTKCT6","ID38":"M3SB9FU89B6G4","ID39":"H966L25P5JWRA","ID40":"LUBAANPJ4KHTW","ID41":"FKVNH874CDU6E","ID42":"Z4FWKPSCMB3FQ","ID43":"5P8AQVH58GAXG","ID44":"VQ8SF4DM2QGXS",
    "ID45":"QKHBT9AKT52AW","ID46":"KFGS9H38KZPW8","ID47":"6EUEAHYBJG8AG","ID48":"YGEAXXKKKMSU8","ID49":"S95WP8CY7ZPN6","ID50":"H35R5PH8B4YXA","ID51":"LEGVEK5K6TNYW","ID52":"V99U9TC8JQ446"
  };

  // Stockage des sélections
  const selections = {};

  function updateButton(ref) {
    try {
      const select = document.getElementById(ref);
      const chosenId = select.value;
      const chosenText = select.options[select.selectedIndex].text;

      if (chosenId) {
        selections[ref] = chosenText;
      } else {
        delete selections[ref]; // si l'utilisateur remet "-- Sélectionnez --"
      }

      const produitsEl = document.getElementById('produits');
      produitsEl.value = Object.values(selections).join(' ; ');

      const container = document.getElementById('paypal-' + ref);
      container.innerHTML = "";
      const hostedId = paypalIDs[chosenId];
      if (hostedId) {
        paypal.HostedButtons({ hostedButtonId: hostedId }).render("#" + container.id);
      }
    } catch (e) {
      console.error("updateButton error", e);
    }
  }

  // Charger les points relais
  async function loadRelais() {
    const cp = document.getElementById('cp').value;
    if (!cp) return;
    try {
      const response = await fetch(`https://apilesbordes.synology.me/mondialrelay.php?cp=${cp}`);
      if (!response.ok) throw new Error("Serveur NAS indisponible");
      const relais = await response.json();
      afficherRelais(relais);
    } catch (e) {
      document.getElementById('relais-list').innerHTML = "<p style='color:red'>Impossible de charger la liste automatique.<br>Merci de saisir manuellement votre point relais ci-dessous :</p>";
    }
  }

  // Affichage points relais
  function afficherRelais(relais) {
    const container = document.getElementById('relais-list');
    container.innerHTML = "";
    relais.forEach(r => {
      const div = document.createElement('div');
      div.className = "relais-item";
      div.textContent = `${r.nom}, ${r.adresse}, ${r.cp} ${r.ville}`;
      div.onclick = () => {
        document.getElementById('pointrelais').value = div.textContent;
      };
      container.appendChild(div);
    });
  }
</script>

</body>
</html>